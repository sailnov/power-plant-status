<html>
<head>
<script type="text/JavaScript">
const imageUrl = "CAM11.jpg"; // url to load image from
let lastSize = null;
var refreshInterval = 3000; //in ms
var drawDate = false; //draw date string
var img;

function init() {
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");
    img = new Image();
    img.onload = function() {
        canvas.setAttribute("width", img.width)
        canvas.setAttribute("height", img.height)
        context.drawImage(this, 0, 0);
        if(drawDate) {
            var now = new Date();
            var text = now.toLocaleDateString() + " " + now.toLocaleTimeString();
            var maxWidth = 100;
            var x = img.width-10-maxWidth;
            var y = img.height-10;
            context.strokeStyle = 'black';
            context.lineWidth = 2;
            context.strokeText(text, x, y, maxWidth);
            context.fillStyle = 'white';
            context.fillText(text, x, y, maxWidth);
        }
    };
    refresh();
}
function refresh()
{
    img.src = imageUrl + "?t=" + new Date().getTime();
    setInterval(checkImageSize, refreshInterval);  
}
async function checkImageSize() {
    try {
        const response = await fetch(imageUrl, { method: "HEAD" });
        const newSize = response.headers.get("Content-Length");
        if (newSize > 102400 && newSize !== lastSize) {
            refresh();
        }
        lastSize = newSize;
    } catch (error) {
        // console.error("Error checking image size:", error);
    }
}

setInterval(checkImageSize, refreshInterval);
</script>
<title>Monitor</title>
</head>

<body onload="JavaScript:init();">
<canvas id="canvas" style="width: 100%"/>
</body>
</html>
