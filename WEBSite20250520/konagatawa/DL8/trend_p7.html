<!DOCTYPE html>
<html><head><title>小長辿小水力発電</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="viewport" content="width=1024">
<LINK REL="stylesheet" TYPE="text/css" HREF="common.css">
<LINK REL="stylesheet" TYPE="text/css" HREF="trend.css">
<LINK REL="stylesheet" TYPE="text/css" HREF="cursor_pen.css">
<script type="text/javascript" src="button_enable.js"></script>
<script type="text/javascript" src="trend_page.js"></script>
<script type="text/javascript" src="dl_header.js"></script>
<script type="text/javascript" src="trend_p7.js"></script>
<script type="text/javascript" src="button_event.js"></script>
<script type="text/javascript" src="xml_cmd.js" ></script>
<!--[if lt IE 9]>
<script type="text/javascript" src="excanvas.js"></script>
<![endif]-->
<script type="text/javascript" src="trend_draw.js"></script>
<script type="text/javascript" src="cursor_pen.js"></script>
<script type="text/javascript">
var images = new Array(100);
var images_idx = 0;
image_preload = function(e) {
	images[images_idx] = new Image();
	images[images_idx].src = e;
	images_idx++;
}

var now_page="p7";
var trend_html = "trend_" + now_page + ".html";
var trend_js   = "trend_" + now_page + ".js";
var trend_json = "trend_" + now_page + ".json";
var ref_key    = "REF_"   + now_page;

var scroll_pos = 0;
var print_mode = 0;
var touch = 0;
var auto_updating = 0;
var right_offset = 0;
var browser = "IE";

function print_change() {
	if( print_mode == 0 ){
		print_mode = 1;
		scroll_pos = Math.floor(document.getElementById("draw_area").scrollLeft);
		trend_draw(0);
		alert("print mode");
	} else{
		trend_draw(1);
		document.getElementById("draw_area").scrollLeft = scroll_pos;
		print_mode = 0;
		alert("normal mode");
	}
}

function update_local()
{
	file_load_ie( "./" + trend_html );
	file_load_ie( "./trend_page.js" );
	file_load_ie( "./" + trend_js );
	update();
}

function update_timeout()
{
	auto_updating = 0;
}

function update_auto()
{
	update_header_time();
	trend_draw(1);
	trend_modify(trend_samples-1);
	auto_updating = 0;
}

function update_check()
{
	var pos = Math.floor(document.getElementById("draw_area").scrollWidth) - Math.floor(document.getElementById("draw_area").scrollLeft) - window_x;
	if( (print_mode == 0) && (scroll_ok == 0) && (pos <= right_offset) ){
		return 1;
	}
	return 0;
}

function update_refresh()
{
	if( auto_updating != 0 ) return;

	var pos = Math.floor(document.getElementById("draw_area").scrollWidth) - Math.floor(document.getElementById("draw_area").scrollLeft) - window_x;

	if( browser == "Chrome" ){
		if( window.devicePixelRatio == 1 )	right_offset = 0;
		else								right_offset = 3;
	}

	if( (print_mode == 0) && (scroll_ok == 0) && (pos <= right_offset) ){

		if( touch != 0 ){
			touch = 0;
			return;
		}
		auto_updating = 1;
		update_trend_data( trend_json, now_page, update_check, update_auto, update_timeout, 0 );
	}
}

window.onload = function() {
	image_preload("004_ON.JPG");
	image_preload("005_ON.JPG");
	image_preload("006_ON.JPG");
	image_preload("007_ON.JPG");
	image_preload("008_ON.JPG");
	image_preload("P1_ON.JPG");
	image_preload("P2_ON.JPG");
	image_preload("P3_ON.JPG");
	image_preload("P4_ON.JPG");
	image_preload("P5_ON.JPG");
	image_preload("P6_ON.JPG");
	image_preload("P7_ON.JPG");
	image_preload("P8_ON.JPG");

	var userAgent = window.navigator.userAgent.toLowerCase();
	if( userAgent.indexOf("safari")  != -1 )		browser = "Safari";
	if( userAgent.indexOf("chrome")  != -1 )		browser = "Chrome";
	if( userAgent.indexOf("firefox") != -1 )		browser = "Firefox";
	if( userAgent.indexOf("opera")   != -1 )		browser = "Opera";

	trend_init( now_page );
	page_button();
	update_header();

//	auto_updating = 1;
//	update_trend_data( trend_json, now_page, null, update_auto, update_timeout, 1 );
	trend_draw(1);

	if( button_disable == 0 ){
		var ref = getCookie( ref_key );
		if( ref == "" ){
			ref = "0";
		}
		if( ref != 0 ){
			setInterval("update_refresh()",ref*1000);
		}
	}

}

function refresh_rate()
{
	if( button_disable != 0 ) return;

	var ref = getCookie( ref_key );
	if( ref == "" ){
		ref = "0";
	}
	var rtn = window.prompt( "auto refresh rate 0-999[s]", ref );
	if( rtn != null ){
		if( rtn.match(/[^0-9]/) ){
			alert("input error");
			return;
		}

		var num = Number(rtn);
		if( (num < 0) || (num > 999) ){
			alert("input error");
			return;
		}

		setCookieX( ref_key, rtn );
		update_local();
	}
}
</script>
</head>

<body style="background-color: #000000;">

<!-- HEADER -->
<div>
	<table class="header">
	  <tbody><tr>
    	<td class="name1" id="name1"></td>
    	<td class="name2" id="name2"></td>
    	<td class="fig1"></td>
      </tr></tbody>
    </table>
</div>

<!-- MENU -->
<div>
	<!-- Menu -->
	<input class ="menu" type="button" onclick="disp_menu();">

	<!-- Data -->
	<input class ="data" type="button" onclick="disp_data();">

	<!-- Trend -->
	<input class ="trend_sel" type="button" title="normal mode <-> print mode" onclick="print_change();">

	<!-- Event -->
	<input class ="event" type="button" onclick="disp_event();">

	<!-- Update -->
	<input class ="update" type="button" onclick="update_local();">
</div>

<!-- FUNCTION -->
<div>
	<!-- background -->
	<div class="p0"></div>

	<!-- P1 -->
	<div id="p1"></div>

	<!-- P2 -->
	<div id="p2"></div>

	<!-- P3 -->
	<div id="p3"></div>

	<!-- P4 -->
	<div id="p4"></div>

	<!-- P5 -->
	<div id="p5"></div>

	<!-- P6 -->
	<div id="p6"></div>

	<!-- P7 -->
	<div id="p7"></div>

	<!-- P8 -->
	<div id="p8"></div>

	<!-- background -->
	<div class="p9"></div>
</div>

<!-- TIME,NAME3,DATE -->
<div>
	<table class="time_name3_date">
	  <tbody><tr>
    	<td class="back18"></td>
    	<td class="time" id="time"></td>
    	<td class="name3" id="name3"></td>
    	<td class="date" id="date"></td>
    	<td class="back22"></td>
      </tr></tbody>
    </table>
</div>



<!-- TREND GROUP -->
<div>
<table class="trend_group">
	  <tbody><tr>
	    <td class="trend_dummy" id="trend_dummy"></td>
	    <td class="trend_pname" id="trend_pname"></td>
	    <td class="trend_time" id="trend_time"></td>
      </tr></tbody>
    </table>
</div>

<!-- GRAPH -->
<div class="graph_base">
	<table class="graph" id="graph">
	  <tbody>
	  <tr>
    	<td class="scale_dummy"></td>
    	<td id="graph_area" class="graph_area" rowspan="10" onselectstart="return false;" unselectable="on"></td>
    	<td class="pen_moving_dummy"></td>
    	<td class="pen_dummy"></td>
    	<td class="num_dummy"></td>
      </tr>

	  <tr>
    	<td id="scale_100" class="scale_100" rowspan="2"></td>
    	<td class="pen_moving_area" rowspan="2"></td>
    	<td id="mark_p1" class="pen_mark"></td>
    	<td id="num_p1" class="num" rowspan="2"></td></tr>
    	<tr><td id="no_p1" class="pen_no"></td>
      </tr>

	  <tr>
    	<td id="scale_p2" class="scale_blank" rowspan="2"></td>
    	<td class="pen_moving_area" rowspan="2"></td>
    	<td id="mark_p2" class="pen_mark"></td>
    	<td id="num_p2" class="num" rowspan="2"></td></tr>
    	<tr><td id="no_p2" class="pen_no"></td>
      </tr>

	  <tr>
    	<td id="scale_p3" class="scale_blank" rowspan="2"></td>
    	<td class="pen_moving_area" rowspan="2"></td>
    	<td id="mark_p3" class="pen_mark"></td>
    	<td id="num_p3" class="num" rowspan="2"></td></tr>
    	<tr><td id="no_p3" class="pen_no"></td>
      </tr>

	  <tr>
    	<td id="scale_0" class="scale_0" rowspan="2"></td>
    	<td class="pen_moving_area" rowspan="2"></td>
    	<td id="mark_p4" class="pen_mark"></td>
    	<td id="num_p4" class="num" rowspan="2"></td></tr>
    	<tr><td id="no_p4" class="pen_no"></td>
      </tr>

	  <tr>
    	<td class="scale_dummy"></td>
    	<td class="pen_moving_dummy"></td>
    	<td class="pen_dummy"></td>
    	<td class="num_dummy"></td>
      </tr>
      </tbody>
    </table>
</div>

<div id="draw_area" class="draw_area" onselectstart="return false;" unselectable="on">
	<canvas id="draw_area_canvas" class="draw_area_canvas"></canvas>
</div>
<div class="num_p1x" id="num_p1x"></div>
<div class="num_p2x" id="num_p2x"></div>
<div class="num_p3x" id="num_p3x"></div>
<div class="num_p4x" id="num_p4x"></div>

<div class="pen_bkground" id="pen_bkground"></div>

<script type="text/javascript">
var scroll_ok = 0;
var now_scroll = 0;

document.getElementById("draw_area").onscroll = function() {

	if( print_mode != 0 ) return;

	var pos = Math.floor(document.getElementById("draw_area").scrollWidth) - Math.floor(document.getElementById("draw_area").scrollLeft) - window_x;
	if( browser == "Chrome" ){
		if( pos < 0 ){
			pos = 0;
			document.getElementById("draw_area").scrollLeft = Math.floor(document.getElementById("draw_area").scrollWidth);
			return;
		}
	}
	else{
		if( pos < 0 ){
			document.getElementById("draw_area").scrollLeft -= pos;
			return;
		}
	}

	if( browser == "Chrome" ){
		if( window.devicePixelRatio == 1 )	right_offset = 0;
		else								right_offset = 3;
	}

	if( pos <= right_offset ) pos = 0;

	if( print_mode == 0 ){
		if(trend_samples < trend_max_smp){
			trend_modify(trend_samples-1-pos);
		}
		else{
			if(trend_samples-1-pos > 0){
				trend_modify(trend_samples-1-pos);
			}
			else{
				trend_modify(0);
			}
		}
	}
}

function OnDown(event){
	if( print_mode != 0 ) return;
	if( scroll_ok == 0 ){
		now_scroll = event.clientX;
		scroll_ok = 1;
	}
}
function OnMove(event){
	if( print_mode != 0 ) return;
	if( scroll_ok == 1 ){
		var pos = event.clientX;
		document.getElementById("draw_area").scrollLeft += ( now_scroll - pos );
		now_scroll = pos;
	}
}
function OnOut(event){
	scroll_ok = 0;
}
function OnUp(event){
	scroll_ok = 0;
}
function OnTouchStart(event){
	if( print_mode != 0 ) return;
	var e = event.touches[0];
	now_scroll = e.clientX;
	touch = 1;
}
function OnTouchMove(event){
	if( print_mode != 0 ) return;
	var e = event.touches[0];
	var pos = e.clientX;

	var left = Math.floor(document.getElementById("draw_area").scrollLeft);
	var move = now_scroll - pos;

	now_scroll = pos;
	touch = 1;
}

function OnEvent(event){

	var e = (event) || window.event;

	switch(e.type){
        case 'pointerdown':
        case 'mousedown':
			OnDown(e);
            break;
		case 'touchstart':
			OnTouchStart(e);
			break;
		case 'pointermove':
		case 'mousemove':
			OnMove(e);
			break;
        case 'touchmove':
			OnTouchMove(e);
			break;
        case 'pointerup':
        case 'pointerout':
        case 'mouseup':
		case 'mouseout':
			OnOut(e);
			break;
		case 'pointercancel':
        case 'pointerleave':
		case 'mouseleave':
		case 'touchend':
        case 'touchcancel':
            break;
	}
}

// body(DOM) → body(js) → onload
if(window.PointerEvent){
	var elm = document.getElementById("draw_area_canvas")
	elm.addEventListener('pointerdown', OnEvent, false)
	elm.addEventListener('pointerup', OnEvent, false)
	elm.addEventListener('pointermove', OnEvent, false)
	elm.addEventListener('pointerout', OnEvent, false)
	// elm.addEventListener('pointercancel', OnEvent, false)
	// elm.addEventListener('pointerleave', OnEvent, false)
}
else if(window.navigator.pointerEnabled){
	var elm = document.getElementById("draw_area_canvas")
	elm.addEventListener('pointerdown', OnEvent, false)
	elm.addEventListener('pointerup', OnEvent, false)
	elm.addEventListener('pointermove', OnEvent, false)
	elm.addEventListener('pointerout', OnEvent, false)
	// elm.addEventListener('pointercancel', OnEvent, false)
	// elm.addEventListener('pointerleave', OnEvent, false)
}
else {
	if('onmousedown' in document){
		var elm = document.getElementById("draw_area_canvas")
		elm.addEventListener('mousedown', OnEvent, false)
		elm.addEventListener('mouseup', OnEvent, false)
		elm.addEventListener('mousemove', OnEvent, false)
		elm.addEventListener('mouseout', OnEvent, false)
		elm.addEventListener('mouseleave', OnEvent, false)
	}
	if('ontouchstart' in document){
		var elm = document.getElementById("draw_area_canvas")
		elm.addEventListener('touchstart', OnEvent, false)
		elm.addEventListener('touchmove', OnEvent, false)
		elm.addEventListener('touchend', OnEvent, false)
		elm.addEventListener('touchcancel', OnEvent, false)
	}
}
</script>

</body></html>



